exports.GoogleAPIRequest = GoogleAPIRequest

var util   = require('util');
var querystring = require('querystring');

var OAuth = require('google-oauth');
var rest = require('restler');

function GoogleAPIRequest(consumer_key, consumer_secret,callback_url){
  this.key = consumer_key;
  this.oauth = new OAuth.OAuth2(
    consumer_key, 
    consumer_secret,
    callback_url);
}

GoogleAPIRequest.prototype.sendRequest = function(type, url, option, body, callback) {

  if((callback === null || callback === undefined) && body !== null) {
    callback = body;
    body = null;
  }

  if((callback === null || callback === undefined) && option !== null) {
    callback = option;
    option = null;
  }

  if(body && typeof body == 'object'){
    body = JSON.stringify(body)
  } 
  
  callback = callback || function(){};
  option = option || {};
  option.access_token = access_token;
  option.key = this.key;
  
  var restRequest = null;
  var requestOption = { query:option, parser:rest.parsers.json };
  if(body){
    requestOption.data = body;
    requestOption.headers = {};
    requestOption.headers['content-type'] = 'application/json';
  }  
  
  switch(type.toLowerCase()){
    
    case 'del':
    case 'delete': 
        restRequest = rest.del(url, requestOption);
      break;
      
    case 'put': restRequest = rest.put(url, requestOption);
      break;
    
    case 'post': restRequest = rest.post(url, requestOption);
      break;
    
    default : restRequest = rest.get(url, requestOption);
  }
  

  restRequest.on('complete', function(result, response ) {
    console.log("Completed rest request to ", url);
    if(result instanceof Error || response.statusCode != 200){  
      return callback(result, response.rawEncoded);
    }
    
    return callback(null, result);
  })
}